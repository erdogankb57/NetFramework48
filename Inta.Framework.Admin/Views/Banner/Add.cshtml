@model Inta.Framework.Entity.Banner
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<SelectListItem> targets = new List<SelectListItem>();
    targets.Add(new SelectListItem { Text = "Seçiniz", Value = "" });
    targets.Add(new SelectListItem { Text = "Farklı sekmede aç", Value = "0" });
    targets.Add(new SelectListItem { Text = "Aynı sayfada aç", Value = "1" });

    int languageId = Convert.ToInt32(ViewBag.LanguageId);
}

<div class="form-content">
    <div class="popupMessage"></div>

    <form id="saveForm" method="post" novalidate>

        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Banner Tipi</label>
                </div>
                <div class="col-lg-9">

                    @{
                        @Html.Raw(Html.SelectListFor("Select * from BannerType", ObjectId: "BannerTypeId", ObjectName: "BannerTypeId", DisplayName: "Name", ValueName: "Id", SelectedValue: Model.BannerTypeId.ToString(), DefaultText: "Seçiniz", DefaultValue: "", IsRequired: false));
                    }

                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Banner Adı</label>
                </div><div class="col-lg-9">
                    @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Link</label>
                </div><div class="col-lg-9">
                    @Html.TextBoxFor(m => m.Link, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Açılış tipi</label>
                </div>
                <div class="col-lg-9">
                    @Html.DropDownListFor(m => m.TargetId, targets, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Kısa Açıklama</label>
                </div><div class="col-lg-9">
                    @Html.TextAreaFor(m => m.ShortExplanation, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Sıra Numarası</label>
                </div><div class="col-lg-9">
                    @Html.TextBoxFor(m => m.OrderNumber, new { @class = "form-control", @required = "required", @numeric = "numeric", })
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Aktif mi</label>
                </div>
                <div class="col-lg-9">
                    <div class="form-check">
                        @Html.CheckBoxFor(m => m.IsActive, new { @class = "form-check-input" })

                    </div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="row">
                <div class="col-lg-3">
                    <label for="exampleFormControlInput1">Resim</label>
                </div><div class="col-lg-9">
                    @Html.ImageFileUploadFor(Id: Model.Id, ObjectId: "FileImage", ObjectName: "FileImage", Image: Model.Image, DeleteUrl: "/Banner/DeleteImage", ListObjectId: "PagingDataList", isBigImage: false)
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" id="btnsubmit" class="btn btn-standart">Kaydet</button>
        </div>
    </form>
</div>

<script type="text/javascript">
    $(function () {
        $("#saveForm").submit(function (e) {
            e.preventDefault();

            $("#saveForm .error").remove();



            var formData = new FormData($('#saveForm')[0]);
            $.ajax({
                url: "/Banner/Save",
                type: "POST",
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (data) {

                    if (data.ResultType == 0) {
                        $("#saveForm").find("button[type='submit']").prop('disabled', false);

                        setTimeout(function () {
                            showAlert(".popupMessage", "Kayıt işlemi başarıyla tamamlandı.", "success");
                        }, 100);
                    }
                    else {
                        //Hata mesajı var ise hataları gösterir
                        if (data.Validation != null) {
                            if (data.Validation.length > 0) {
                                for (var i = 0; i < data.Validation.length; i++) {
                                    var item = data.Validation[i];
                                    var key = item.Key;
                                    console.log(key);
                                    for (var j = 0; j < item.Error.length; j++) {
                                        var ErrorMessage = item.Error[j].ErrorMessage;
                                        $("#saveForm #" + key).parent("div").append("<div class='error text-danger'>" + ErrorMessage + "</div>");
                                    }
                                }
                            }
                        } else {
                            setTimeout(function () {
                                showAlert(".popupMessage", "Kayıt işlemi sırasında hata oluştu. Lütfen alanları kontrol ediniz.", "error");
                            }, 100);
                        }
                    }


                    $("#saveForm").find("button[type='submit']").prop('disabled', false);


                }, error: function (data) {
                    setTimeout(function () {
                        showAlert(".popupMessage", "Kayıt işlemi sırasında hata oluştu. Lütfen alanları kontrol ediniz.", "error");
                    }, 100);
                }
            });
        });


    });
</script>